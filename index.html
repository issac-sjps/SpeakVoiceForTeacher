<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ëã±ÊñáÂè£Ë™™Âá∫È°åÁ≥ªÁµ±</title>
    <style>
        body {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100%;
        }
        
        html {
            height: 100%;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100%;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            font-size: 1.1rem;
        }
        
        textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 16px;
            font-family: inherit;
            resize: vertical;
            transition: border-color 0.3s ease;
        }
        
        textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .generate-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            width: 100%;
        }
        
        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .generate-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .result-section {
            display: none;
            margin-top: 30px;
        }
        
        .audio-player {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .play-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            margin: 0 10px;
            transition: background-color 0.3s ease;
        }
        
        .play-btn:hover {
            background: #218838;
        }
        
        .download-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            margin: 0 10px;
            transition: background-color 0.3s ease;
        }
        
        .download-btn:hover {
            background: #0056b3;
        }
        
        .text-display {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
        }
        
        .english-text {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }
        
        .chinese-text {
            font-size: 1rem;
            color: #666;
        }
        
        .loading {
            text-align: center;
            color: #667eea;
            font-weight: 600;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #dc3545;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #28a745;
        }
        
        .script-editor {
            margin-top: 20px;
        }
        
        .script-item {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            position: relative;
        }
        
        .script-item.text-item {
            border-left: 4px solid #28a745;
        }
        
        .script-item.pause-item {
            border-left: 4px solid #ffc107;
            background: #fff8e1;
        }
        
        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .item-type {
            font-weight: 600;
            color: #495057;
        }
        
        .delete-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .delete-btn:hover {
            background: #c82333;
        }
        
        .text-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 15px;
            resize: vertical;
        }
        
        .voice-select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .pause-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .pause-slider {
            flex: 1;
        }
        
        .pause-value {
            font-weight: 600;
            color: #ffc107;
            min-width: 60px;
        }
        
        .add-buttons {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .add-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s ease;
        }
        
        .add-btn:hover {
            background: #5a6268;
        }
        
        .text-btn {
            background: #28a745;
        }
        
        .text-btn:hover {
            background: #218838;
        }
        
        .pause-btn {
            background: #ffc107;
            color: #212529;
        }
        
        .pause-btn:hover {
            background: #e0a800;
        }
        
        .empty-state {
            text-align: center;
            color: #6c757d;
            padding: 40px;
            border: 2px dashed #dee2e6;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .voice-mode-selector {
            margin-bottom: 30px;
        }
        
        .mode-buttons {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .mode-btn {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            background: white;
            color: #495057;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .mode-btn:hover {
            border-color: #667eea;
            color: #667eea;
        }
        
        .mode-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }
        
        .mode-info {
            margin-top: 15px;
        }
        
        .info-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            border-left: 4px solid #28a745;
        }
        
        .info-card h4 {
            margin: 0 0 15px 0;
            color: #333;
        }
        
        .info-card ul {
            margin: 0;
            padding-left: 20px;
        }
        
        .info-card li {
            margin-bottom: 8px;
            color: #555;
        }
        
        .premium-info {
            border-left-color: #ffc107;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>üéØ Ëã±ÊñáÂè£Ë™™Âá∫È°åÁ≥ªÁµ±</h1>
            <p>Ëº∏ÂÖ•Ëã±ÊñáÂíå‰∏≠ÊñáÂéüÊñáÔºåÁîüÊàêÈÅìÂú∞ÁæéÂºèÁôºÈü≥ÁöÑMP3Ê™îÊ°à</p>
        </header>
        
        <main>
            <div class="card">
                <div class="voice-mode-selector">
                    <h3>üéµ Ë™ûÈü≥Ê®°ÂºèÈÅ∏Êìá</h3>
                    <div class="mode-buttons">
                        <button type="button" class="mode-btn active" id="freeMode">
                            üÜì ÂÖçË≤ªÊ®°Âºè (ÁÄèË¶ΩÂô®ÂÖßÂª∫)
                        </button>
                        <button type="button" class="mode-btn" id="premiumMode">
                            ‚≠ê È´òÂìÅË≥™Ê®°Âºè (ÈúÄË¶Å API Key)
                        </button>
                    </div>
                    
                    <div class="api-setup" id="apiSetup" style="display: none;">
                        <div class="form-group">
                            <label for="apiKey">Google Cloud Text-to-Speech API KeyÔºö</label>
                            <input 
                                type="password" 
                                id="apiKey" 
                                placeholder="Ë´ãËº∏ÂÖ•ÊÇ®ÁöÑ Google Cloud API Key"
                                style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 16px;"
                            >
                            <small style="color: #666; display: block; margin-top: 5px;">
                                <strong>üìã Ë®≠ÂÆöÊ≠•È©üÔºö</strong><br>
                                1. Âà∞ <a href="https://console.cloud.google.com/" target="_blank" rel="noopener noreferrer">Google Cloud Console</a> Âª∫Á´ãÂ∞àÊ°à<br>
                                2. ÂïüÁî® <a href="https://console.cloud.google.com/apis/library/texttospeech.googleapis.com" target="_blank" rel="noopener noreferrer">Text-to-Speech API</a><br>
                                3. Âà∞ <a href="https://console.cloud.google.com/apis/credentials" target="_blank" rel="noopener noreferrer">ÊÜëË≠âÈ†ÅÈù¢</a> Âª∫Á´ã API Key<br>
                                üíæ ÊÇ®ÁöÑ API Key ÊúÉËá™ÂãïÂÑ≤Â≠òÂú®ÈÄôÂè∞ÈõªËÖ¶‰∏äÔºå‰∏ãÊ¨°ÈñãÂïüÊúÉËá™ÂãïËºâÂÖ•
                            </small>
                        </div>
                    </div>
                    
                    <div class="mode-info" id="modeInfo">
                        <div class="info-card free-info">
                            <h4>üÜì ÂÖçË≤ªÊ®°ÂºèÁâπËâ≤</h4>
                            <ul>
                                <li>‚úÖ ÂÆåÂÖ®ÂÖçË≤ªÔºåÁÑ°ÈúÄË®ªÂÜä</li>
                                <li>‚úÖ ÊîØÊè¥Â§öÁ®ÆË™ûÈü≥ÈÅ∏È†Ö</li>
                                <li>‚úÖ Âç≥ÊôÇÁîüÊàêÔºåÁÑ°ÈúÄÁ≠âÂæÖ</li>
                                <li>‚ö†Ô∏è Èü≥Ë≥™ËºÉÂü∫Êú¨</li>
                                <li>‚ö†Ô∏è ÁÑ°Ê≥ï‰∏ãËºâ MP3 Ê™îÊ°à</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div class="script-editor">
                    <h3>üìù Ë™ûÈü≥ËÖ≥Êú¨Á∑®ËºØÂô®</h3>
                    <div id="scriptItems"></div>
                    
                    <div class="add-buttons">
                        <button type="button" class="add-btn text-btn" id="addTextBtn">
                            ‚ûï Êñ∞Â¢ûÊñáÂ≠óÊÆµËêΩ
                        </button>
                        <button type="button" class="add-btn pause-btn" id="addPauseBtn">
                            ‚è∏Ô∏è Êñ∞Â¢ûÊö´ÂÅú
                        </button>
                    </div>
                    
                    <button type="button" class="generate-btn" id="generateBtn">
                        üéµ ÁîüÊàêÂÆåÊï¥Ë™ûÈü≥Ê™îÊ°à
                    </button>
                </div>
            </div>
            
            <div class="card result-section" id="resultSection">
                <h3>üéµ Ë™ûÈü≥Ê™îÊ°àÂ∑≤ÁîüÊàê</h3>
                
                <div class="audio-player">
                    <p>ÊÇ®ÁöÑË™ûÈü≥ËÖ≥Êú¨Â∑≤ÊàêÂäüÁîüÊàêÁÇ∫ MP3 Ê™îÊ°àÔºö</p>
                    <button class="play-btn" id="playBtn">‚ñ∂Ô∏è Êí≠ÊîæÂÆåÊï¥Ë™ûÈü≥</button>
                    <button class="download-btn" id="downloadBtn">‚¨áÔ∏è ‰∏ãËºâ MP3 Ê™îÊ°à</button>
                </div>
                
                <div id="statusMessage"></div>
            </div>
        </main>
    </div>

    <script>
        class ScriptBasedSpeechGenerator {
            constructor() {
                this.currentAudio = null;
                this.currentBlob = null;
                this.apiKey = '';
                this.scriptItems = [];
                this.itemCounter = 0;
                this.isPremiumMode = false;
                this.initializeElements();
                this.bindEvents();
                this.loadSavedApiKey();
                this.showEmptyState();
            }
            
            initializeElements() {
                this.apiKeyInput = document.getElementById('apiKey');
                this.scriptItemsContainer = document.getElementById('scriptItems');
                this.addTextBtn = document.getElementById('addTextBtn');
                this.addPauseBtn = document.getElementById('addPauseBtn');
                this.generateBtn = document.getElementById('generateBtn');
                this.resultSection = document.getElementById('resultSection');
                this.playBtn = document.getElementById('playBtn');
                this.downloadBtn = document.getElementById('downloadBtn');
                this.statusMessage = document.getElementById('statusMessage');
                this.freeModeBtn = document.getElementById('freeMode');
                this.premiumModeBtn = document.getElementById('premiumMode');
                this.apiSetup = document.getElementById('apiSetup');
                this.modeInfo = document.getElementById('modeInfo');
            }
            
            bindEvents() {
                this.addTextBtn.addEventListener('click', () => this.addTextItem());
                this.addPauseBtn.addEventListener('click', () => this.addPauseItem());
                this.generateBtn.addEventListener('click', () => this.generateScript());
                this.playBtn.addEventListener('click', () => this.playAudio());
                this.downloadBtn.addEventListener('click', () => this.downloadAudio());
                this.apiKeyInput.addEventListener('input', (e) => this.saveApiKey(e.target.value));
                this.freeModeBtn.addEventListener('click', () => this.switchToFreeMode());
                this.premiumModeBtn.addEventListener('click', () => this.switchToPremiumMode());
            }
            
            loadSavedApiKey() {
                const savedKey = localStorage.getItem('googleAIApiKey');
                if (savedKey) {
                    this.apiKeyInput.value = savedKey;
                    this.apiKey = savedKey;
                    console.log('Â∑≤ËºâÂÖ•ÂÑ≤Â≠òÁöÑ API Key');
                }
            }
            
            saveApiKey(key) {
                this.apiKey = key.trim();
                if (this.apiKey) {
                    localStorage.setItem('googleAIApiKey', this.apiKey);
                    console.log('API Key Â∑≤ÂÑ≤Â≠òÂà∞Êú¨Âú∞');
                    this.showMessage('‚úÖ API Key Â∑≤ÂÑ≤Â≠òÔºÅ‰∏ãÊ¨°ÈñãÂïüÁ∂≤È†ÅÊúÉËá™ÂãïËºâÂÖ•', 'success');
                } else {
                    localStorage.removeItem('googleAIApiKey');
                    console.log('API Key Â∑≤Ê∏ÖÈô§');
                }
            }
            
            switchToFreeMode() {
                this.isPremiumMode = false;
                this.freeModeBtn.classList.add('active');
                this.premiumModeBtn.classList.remove('active');
                this.apiSetup.style.display = 'none';
                this.updateModeInfo();
                this.renderScriptItems(); // ÈáçÊñ∞Ê∏≤Êüì‰ª•Êõ¥Êñ∞Ë™ûÈü≥ÈÅ∏È†Ö
            }
            
            switchToPremiumMode() {
                this.isPremiumMode = true;
                this.premiumModeBtn.classList.add('active');
                this.freeModeBtn.classList.remove('active');
                this.apiSetup.style.display = 'block';
                this.updateModeInfo();
                this.renderScriptItems(); // ÈáçÊñ∞Ê∏≤Êüì‰ª•Êõ¥Êñ∞Ë™ûÈü≥ÈÅ∏È†Ö
            }
            
            updateModeInfo() {
                if (this.isPremiumMode) {
                    this.modeInfo.innerHTML = `
                        <div class="info-card premium-info">
                            <h4>‚≠ê È´òÂìÅË≥™Ê®°ÂºèÁâπËâ≤</h4>
                            <ul>
                                <li>‚úÖ Â∞àÊ•≠Á¥öË™ûÈü≥ÂìÅË≥™</li>
                                <li>‚úÖ Â§öÁ®ÆËá™ÁÑ∂Ë™ûÈü≥ÈÅ∏È†Ö</li>
                                <li>‚úÖ ÂèØ‰∏ãËºâÈ´òÂìÅË≥™ MP3</li>
                                <li>‚úÖ ÊîØÊè¥Ë™ûÈü≥ÂèÉÊï∏Ë™øÊï¥</li>
                                <li>‚ö†Ô∏è ÈúÄË¶Å Google Cloud API Key</li>
                            </ul>
                        </div>
                    `;
                } else {
                    this.modeInfo.innerHTML = `
                        <div class="info-card free-info">
                            <h4>üÜì ÂÖçË≤ªÊ®°ÂºèÁâπËâ≤</h4>
                            <ul>
                                <li>‚úÖ ÂÆåÂÖ®ÂÖçË≤ªÔºåÁÑ°ÈúÄË®ªÂÜä</li>
                                <li>‚úÖ ÊîØÊè¥Â§öÁ®ÆË™ûÈü≥ÈÅ∏È†Ö</li>
                                <li>‚úÖ Âç≥ÊôÇÁîüÊàêÔºåÁÑ°ÈúÄÁ≠âÂæÖ</li>
                                <li>‚ö†Ô∏è Èü≥Ë≥™ËºÉÂü∫Êú¨</li>
                                <li>‚ö†Ô∏è ÂÉÖÊîØÊè¥Á∑ö‰∏äÊí≠Êîæ</li>
                            </ul>
                        </div>
                    `;
                }
            }
            
            getVoiceOptions(selectedVoice) {
                if (this.isPremiumMode) {
                    return `
                        <option value="en-US-Journey-D" ${selectedVoice === 'en-US-Journey-D' ? 'selected' : ''}>ÁæéÂºèËã±Ë™û (Â•≥ÊÄß) - Journey</option>
                        <option value="en-US-Journey-F" ${selectedVoice === 'en-US-Journey-F' ? 'selected' : ''}>ÁæéÂºèËã±Ë™û (Áî∑ÊÄß) - Journey</option>
                        <option value="en-US-Studio-O" ${selectedVoice === 'en-US-Studio-O' ? 'selected' : ''}>ÁæéÂºèËã±Ë™û (Â•≥ÊÄß) - Studio</option>
                        <option value="en-US-Studio-Q" ${selectedVoice === 'en-US-Studio-Q' ? 'selected' : ''}>ÁæéÂºèËã±Ë™û (Áî∑ÊÄß) - Studio</option>
                    `;
                } else {
                    return `
                        <option value="Microsoft Zira - English (United States)" ${selectedVoice === 'Microsoft Zira - English (United States)' ? 'selected' : ''}>ÁæéÂºèËã±Ë™û (Â•≥ÊÄß)</option>
                        <option value="Microsoft David - English (United States)" ${selectedVoice === 'Microsoft David - English (United States)' ? 'selected' : ''}>ÁæéÂºèËã±Ë™û (Áî∑ÊÄß)</option>
                        <option value="Google US English" ${selectedVoice === 'Google US English' ? 'selected' : ''}>Google ÁæéÂºèËã±Ë™û</option>
                        <option value="native" ${selectedVoice === 'native' ? 'selected' : ''}>Á≥ªÁµ±È†êË®≠Ëã±Ë™û</option>
                    `;
                }
            }
            
            showEmptyState() {
                if (this.scriptItems.length === 0) {
                    this.scriptItemsContainer.innerHTML = `
                        <div class="empty-state">
                            <h4>üìù ÈñãÂßãÂª∫Á´ãÊÇ®ÁöÑË™ûÈü≥ËÖ≥Êú¨</h4>
                            <p>ÈªûÊìä‰∏ãÊñπÊåâÈàïÊñ∞Â¢ûÊñáÂ≠óÊÆµËêΩÊàñÊö´ÂÅúÊôÇÈñì</p>
                        </div>
                    `;
                }
            }
            
            addTextItem() {
                const itemId = ++this.itemCounter;
                const defaultVoice = this.isPremiumMode ? 'en-US-Journey-D' : 'Microsoft Zira - English (United States)';
                const item = {
                    id: itemId,
                    type: 'text',
                    text: '',
                    voice: defaultVoice
                };
                
                this.scriptItems.push(item);
                this.renderScriptItems();
            }
            
            addPauseItem() {
                const itemId = ++this.itemCounter;
                const item = {
                    id: itemId,
                    type: 'pause',
                    duration: 2.0
                };
                
                this.scriptItems.push(item);
                this.renderScriptItems();
            }
            
            renderScriptItems() {
                if (this.scriptItems.length === 0) {
                    this.showEmptyState();
                    return;
                }
                
                this.scriptItemsContainer.innerHTML = this.scriptItems.map(item => {
                    if (item.type === 'text') {
                        return this.renderTextItem(item);
                    } else {
                        return this.renderPauseItem(item);
                    }
                }).join('');
                
                // ÈáçÊñ∞Á∂ÅÂÆö‰∫ã‰ª∂
                this.bindItemEvents();
            }
            
            renderTextItem(item) {
                return `
                    <div class="script-item text-item" data-id="${item.id}">
                        <div class="item-header">
                            <span class="item-type">üó£Ô∏è ÊñáÂ≠óÊÆµËêΩ</span>
                            <button class="delete-btn" onclick="generator.deleteItem(${item.id})">Âà™Èô§</button>
                        </div>
                        <textarea 
                            class="text-input" 
                            placeholder="Ë´ãËº∏ÂÖ•Ë¶ÅÊúóËÆÄÁöÑÊñáÂ≠ó..."
                            rows="3"
                            onchange="generator.updateItemText(${item.id}, this.value)"
                        >${item.text}</textarea>
                        <select 
                            class="voice-select" 
                            onchange="generator.updateItemVoice(${item.id}, this.value)"
                        >
                            ${generator.getVoiceOptions(item.voice)}
                        </select>
                    </div>
                `;
            }
            
            renderPauseItem(item) {
                return `
                    <div class="script-item pause-item" data-id="${item.id}">
                        <div class="item-header">
                            <span class="item-type">‚è∏Ô∏è Êö´ÂÅúÊôÇÈñì</span>
                            <button class="delete-btn" onclick="generator.deleteItem(${item.id})">Âà™Èô§</button>
                        </div>
                        <div class="pause-controls">
                            <input 
                                type="range" 
                                class="pause-slider" 
                                min="0.5" 
                                max="10" 
                                step="0.5" 
                                value="${item.duration}"
                                oninput="generator.updatePauseDuration(${item.id}, this.value)"
                            >
                            <span class="pause-value">${item.duration.toFixed(1)} Áßí</span>
                        </div>
                    </div>
                `;
            }
            
            bindItemEvents() {
                // ‰∫ã‰ª∂Â∑≤Âú® HTML ‰∏≠‰ΩøÁî® onclick Á∂ÅÂÆö
            }
            
            updateItemText(itemId, text) {
                const item = this.scriptItems.find(i => i.id === itemId);
                if (item) {
                    item.text = text;
                }
            }
            
            updateItemVoice(itemId, voice) {
                const item = this.scriptItems.find(i => i.id === itemId);
                if (item) {
                    item.voice = voice;
                }
            }
            
            updatePauseDuration(itemId, duration) {
                const item = this.scriptItems.find(i => i.id === itemId);
                if (item) {
                    item.duration = parseFloat(duration);
                    // Êõ¥Êñ∞È°ØÁ§∫
                    const pauseValue = document.querySelector(`[data-id="${itemId}"] .pause-value`);
                    if (pauseValue) {
                        pauseValue.textContent = `${parseFloat(duration).toFixed(1)} Áßí`;
                    }
                }
            }
            
            deleteItem(itemId) {
                this.scriptItems = this.scriptItems.filter(item => item.id !== itemId);
                this.renderScriptItems();
            }
            
            async generateScript() {
                if (this.isPremiumMode && !this.apiKey) {
                    this.showMessage('È´òÂìÅË≥™Ê®°ÂºèÈúÄË¶Å Google Cloud API KeyÔºåË´ãÂÖàËº∏ÂÖ•ÊàñÂàáÊèõÂà∞ÂÖçË≤ªÊ®°Âºè', 'error');
                    return;
                }
                
                if (this.scriptItems.length === 0) {
                    this.showMessage('Ë´ãÂÖàÊñ∞Â¢û‰∏Ä‰∫õÊñáÂ≠óÊÆµËêΩÊàñÊö´ÂÅúÊôÇÈñì', 'error');
                    return;
                }
                
                // Ê™¢Êü•ÊòØÂê¶ÊúâÊñáÂ≠óÂÖßÂÆπ
                const hasText = this.scriptItems.some(item => item.type === 'text' && item.text.trim());
                if (!hasText) {
                    this.showMessage('Ë´ãËá≥Â∞ëÊñ∞Â¢û‰∏ÄÂÄãÂåÖÂê´ÊñáÂ≠óÁöÑÊÆµËêΩ', 'error');
                    return;
                }
                
                this.generateBtn.disabled = true;
                this.generateBtn.textContent = 'üîÑ ÁîüÊàê‰∏≠...';
                this.showMessage('Ê≠£Âú®ÁîüÊàêË™ûÈü≥Ê™îÊ°àÔºåË´ãÁ®çÂÄô...', 'loading');
                
                try {
                    if (this.isPremiumMode) {
                        await this.generateSpeechWithAPI();
                    } else {
                        await this.generateSpeechWithBrowser();
                    }
                } catch (error) {
                    this.showMessage(`ÁîüÊàêË™ûÈü≥ÊôÇÁôºÁîüÈåØË™§Ôºö${error.message}`, 'error');
                    console.error('Speech generation error:', error);
                } finally {
                    this.generateBtn.disabled = false;
                    this.generateBtn.textContent = 'üéµ ÁîüÊàêÂÆåÊï¥Ë™ûÈü≥Ê™îÊ°à';
                }
            }
            
            async generateSpeechWithAPI() {
                console.log('ÈñãÂßãÁîüÊàêË™ûÈü≥ÔºåAPI Key:', this.apiKey ? 'Â∑≤Ë®≠ÂÆö' : 'Êú™Ë®≠ÂÆö');
                console.log('ËÖ≥Êú¨È†ÖÁõÆÊï∏Èáè:', this.scriptItems.length);
                
                // Âª∫Á´ãÁ∞°ÂåñÁöÑÊñáÂ≠óÂÖßÂÆπÔºà‰∏ç‰ΩøÁî®Ë§áÈõúÁöÑ SSMLÔºâ
                let textContent = '';
                
                for (const item of this.scriptItems) {
                    if (item.type === 'text' && item.text.trim()) {
                        textContent += item.text.trim() + ' ';
                        console.log('Ê∑ªÂä†ÊñáÂ≠ó:', item.text.trim());
                    } else if (item.type === 'pause') {
                        // Áî®Âè•Ëôü‰æÜÊ®°Êì¨Êö´ÂÅú
                        textContent += '. ';
                        console.log('Ê∑ªÂä†Êö´ÂÅú:', item.duration + 'Áßí');
                    }
                }
                
                if (!textContent.trim()) {
                    throw new Error('Ê≤íÊúâÊâæÂà∞Ë¶ÅÊúóËÆÄÁöÑÊñáÂ≠óÂÖßÂÆπ');
                }
                
                console.log('ÊúÄÁµÇÊñáÂ≠óÂÖßÂÆπ:', textContent);
                
                // ‰ΩøÁî®Á¨¨‰∏ÄÂÄãÊñáÂ≠óÈ†ÖÁõÆÁöÑË™ûÈü≥Ë®≠ÂÆö
                const firstTextItem = this.scriptItems.find(item => item.type === 'text');
                const voiceName = firstTextItem ? firstTextItem.voice : 'en-US-Journey-D';
                
                try {
                    console.log('ÁôºÈÄÅ API Ë´ãÊ±Ç...');
                    const requestBody = {
                        input: {
                            text: textContent.trim()
                        },
                        voice: {
                            languageCode: 'en-US',
                            name: voiceName
                        },
                        audioConfig: {
                            audioEncoding: 'MP3',
                            speakingRate: 0.9,
                            pitch: 0.0,
                            volumeGainDb: 0.0
                        }
                    };
                    
                    console.log('Ë´ãÊ±ÇÂÖßÂÆπ:', requestBody);
                    
                    const response = await fetch(`https://texttospeech.googleapis.com/v1/text:synthesize?key=${this.apiKey}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(requestBody)
                    });
                    
                    console.log('API ÂõûÊáâÁãÄÊÖã:', response.status);
                    
                    if (!response.ok) {
                        const errorText = await response.text();
                        console.error('API ÈåØË™§ÂõûÊáâ:', errorText);
                        let errorData;
                        try {
                            errorData = JSON.parse(errorText);
                        } catch (e) {
                            throw new Error(`API Ë´ãÊ±ÇÂ§±Êïó (${response.status}): ${errorText}`);
                        }
                        throw new Error(errorData.error?.message || `API Ë´ãÊ±ÇÂ§±Êïó (${response.status})`);
                    }
                    
                    const data = await response.json();
                    console.log('API ÂõûÊáâÊàêÂäüÔºåÈü≥È†ªÂÖßÂÆπÈï∑Â∫¶:', data.audioContent ? data.audioContent.length : 0);
                    
                    if (!data.audioContent) {
                        throw new Error('API ÂõûÊáâ‰∏≠Ê≤íÊúâÈü≥È†ªÂÖßÂÆπ');
                    }
                    
                    // Â∞á base64 Èü≥È†ªËΩâÊèõÁÇ∫ Blob
                    const audioBytes = atob(data.audioContent);
                    const audioArray = new Uint8Array(audioBytes.length);
                    for (let i = 0; i < audioBytes.length; i++) {
                        audioArray[i] = audioBytes.charCodeAt(i);
                    }
                    
                    this.currentBlob = new Blob([audioArray], { type: 'audio/mpeg' });
                    this.currentAudio = new Audio(URL.createObjectURL(this.currentBlob));
                    
                    console.log('Èü≥È†ªÊ™îÊ°àÁîüÊàêÊàêÂäüÔºåÂ§ßÂ∞è:', this.currentBlob.size, 'bytes');
                    
                    // È°ØÁ§∫ÁµêÊûú
                    this.displayResults();
                    
                } catch (error) {
                    console.error('Google API ÈåØË™§:', error);
                    
                    // Ê™¢Êü•‰∏çÂêåÈ°ûÂûãÁöÑ API ÈåØË™§
                    if (error.message.includes('has not been used') || error.message.includes('is disabled')) {
                        this.showMessage(`
                            ‚ùå Google Text-to-Speech API Â∞öÊú™ÂïüÁî®ÔºÅ<br><br>
                            <strong>Ë´ãÊåâÁÖß‰ª•‰∏ãÊ≠•È©üË®≠ÂÆöÔºö</strong><br>
                            1. ÂâçÂæÄ <a href="https://console.cloud.google.com/" target="_blank" rel="noopener noreferrer">Google Cloud Console</a><br>
                            2. ÈÅ∏ÊìáÊàñÂª∫Á´ã‰∏ÄÂÄãÂ∞àÊ°à<br>
                            3. ÂïüÁî® <a href="https://console.cloud.google.com/apis/library/texttospeech.googleapis.com" target="_blank" rel="noopener noreferrer">Text-to-Speech API</a><br>
                            4. Âà∞ <a href="https://console.cloud.google.com/apis/credentials" target="_blank" rel="noopener noreferrer">ÊÜëË≠âÈ†ÅÈù¢</a> Âª∫Á´ã API Key<br>
                            5. Â∞áÊñ∞ÁöÑ API Key Ë≤ºÂà∞‰∏äÊñπËº∏ÂÖ•Ê°Ü<br><br>
                            üí° <strong>ÊèêÁ§∫Ôºö</strong>ÂïüÁî® API ÂæåÂèØËÉΩÈúÄË¶ÅÁ≠âÂæÖÂπæÂàÜÈêòÊâçËÉΩ‰ΩøÁî®
                        `, 'error');
                    } else if (error.message.includes('blocked') || error.message.includes('PERMISSION_DENIED') || error.message.includes('API_KEY_SERVICE_BLOCKED')) {
                        this.showMessage(`
                            üö´ API Key Ê¨äÈôêË¢´ÊãíÁµïÔºÅ<br><br>
                            <strong>ÂèØËÉΩÁöÑÂéüÂõ†ÂíåËß£Ê±∫ÊñπÊ°àÔºö</strong><br>
                            1. <strong>API Êú™ÂïüÁî®Ôºö</strong>Ë´ãÂà∞ <a href="https://console.cloud.google.com/apis/library/texttospeech.googleapis.com" target="_blank" rel="noopener noreferrer">Google Cloud Console</a> ÂïüÁî® Text-to-Speech API<br>
                            2. <strong>API Key ÈôêÂà∂Ôºö</strong>Ê™¢Êü• <a href="https://console.cloud.google.com/apis/credentials" target="_blank" rel="noopener noreferrer">API Key Ë®≠ÂÆö</a> ÊòØÂê¶Êúâ IP ÊàñÁ∂≤ÂüüÈôêÂà∂<br>
                            3. <strong>Ë®àË≤ªÊú™ÂïüÁî®Ôºö</strong>Âà∞ <a href="https://console.cloud.google.com/billing" target="_blank" rel="noopener noreferrer">Ë®àË≤ªÈ†ÅÈù¢</a> ÂïüÁî®Ë®àË≤ªÂ∏≥Êà∂<br>
                            4. <strong>ÈÖçÈ°ç‰∏çË∂≥Ôºö</strong>Ê™¢Êü• <a href="https://console.cloud.google.com/apis/api/texttospeech.googleapis.com/quotas" target="_blank" rel="noopener noreferrer">API ÈÖçÈ°ç</a><br><br>
                            üí° <strong>Âª∫Ë≠∞Ôºö</strong>ÂàáÊèõÂà∞ÂÖçË≤ªÊ®°ÂºèÁπºÁ∫å‰ΩøÁî®ÔºåÊàñÈáçÊñ∞Âª∫Á´ã‰∏ÄÂÄãÊñ∞ÁöÑ API Key
                        `, 'error');
                    } else if (error.message.includes('INVALID_ARGUMENT') || error.message.includes('400')) {
                        this.showMessage(`
                            ‚ö†Ô∏è API Ë´ãÊ±ÇÂèÉÊï∏ÈåØË™§ÔºÅ<br><br>
                            <strong>ÂèØËÉΩÁöÑÂïèÈ°åÔºö</strong><br>
                            ‚Ä¢ ÊñáÂ≠óÂÖßÂÆπÊ†ºÂºè‰∏çÊ≠£Á¢∫<br>
                            ‚Ä¢ Ë™ûÈü≥ÂèÉÊï∏Ë®≠ÂÆöÊúâË™§<br>
                            ‚Ä¢ API Key Ê†ºÂºèÈåØË™§<br><br>
                            üí° <strong>Âª∫Ë≠∞Ôºö</strong>ÂàáÊèõÂà∞ÂÖçË≤ªÊ®°ÂºèÊàñÊ™¢Êü•Ëº∏ÂÖ•ÂÖßÂÆπ
                        `, 'error');
                    } else if (error.message.includes('UNAUTHENTICATED') || error.message.includes('401')) {
                        this.showMessage(`
                            üîë API Key È©óË≠âÂ§±ÊïóÔºÅ<br><br>
                            <strong>Ë´ãÊ™¢Êü•Ôºö</strong><br>
                            ‚Ä¢ API Key ÊòØÂê¶Ê≠£Á¢∫Ë§áË£Ω<br>
                            ‚Ä¢ API Key ÊòØÂê¶Â∑≤ÈÅéÊúü<br>
                            ‚Ä¢ ÊòØÂê¶‰ΩøÁî®‰∫ÜÊ≠£Á¢∫ÁöÑ Google Cloud Â∞àÊ°à<br><br>
                            üí° <strong>Âª∫Ë≠∞Ôºö</strong>ÈáçÊñ∞Áî¢Áîü‰∏ÄÂÄãÊñ∞ÁöÑ API Key
                        `, 'error');
                    } else {
                        // ÂÖ∂‰ªñ API ÈåØË™§ÔºåËá™ÂãïÂàáÊèõÂà∞ÂÖçË≤ªÊ®°Âºè
                        this.showMessage(`
                            ‚ùå Google API ÁôºÁîüÈåØË™§Ôºö${error.message}<br><br>
                            üîÑ <strong>Ëá™ÂãïÂàáÊèõÂà∞ÂÖçË≤ªÊ®°Âºè...</strong><br>
                            ÂÖçË≤ªÊ®°Âºè‰ΩøÁî®ÁÄèË¶ΩÂô®ÂÖßÂª∫Ë™ûÈü≥ÔºåÂÆåÂÖ®ÂÖçË≤ª‰∏îÁÑ°ÈúÄË®≠ÂÆöÔºÅ
                        `, 'error');
                        
                        // Âª∂ÈÅ≤ 2 ÁßíÂæåËá™ÂãïÂàáÊèõ‰∏¶ÈáçÊñ∞ÁîüÊàê
                        setTimeout(async () => {
                            this.switchToFreeMode();
                            this.showMessage('Â∑≤ÂàáÊèõÂà∞ÂÖçË≤ªÊ®°ÂºèÔºåÊ≠£Âú®ÈáçÊñ∞ÁîüÊàêË™ûÈü≥...', 'loading');
                            try {
                                await this.generateSpeechWithBrowser();
                            } catch (browserError) {
                                this.showMessage(`ÁÄèË¶ΩÂô®Ë™ûÈü≥‰πüÂ§±Êïó‰∫ÜÔºö${browserError.message}`, 'error');
                                await this.generateSpeechFallback();
                            }
                        }, 2000);
                    }
                }
            }
            
            async generateSpeechWithBrowser() {
                if (!('speechSynthesis' in window)) {
                    throw new Error('ÊÇ®ÁöÑÁÄèË¶ΩÂô®‰∏çÊîØÊè¥Ë™ûÈü≥ÂêàÊàêÂäüËÉΩ');
                }
                
                console.log('‰ΩøÁî®ÁÄèË¶ΩÂô®ÂÖßÂª∫Ë™ûÈü≥ÂêàÊàê');
                
                // ÂÅúÊ≠¢‰ªª‰ΩïÊ≠£Âú®Êí≠ÊîæÁöÑË™ûÈü≥
                speechSynthesis.cancel();
                
                // Á≠âÂæÖË™ûÈü≥ÂàóË°®ËºâÂÖ•ÂÆåÊàê
                await this.waitForVoices();
                
                // Âª∫Á´ãË™ûÈü≥ËÖ≥Êú¨
                this.speechQueue = [];
                
                for (const item of this.scriptItems) {
                    if (item.type === 'text' && item.text.trim()) {
                        const utterance = new SpeechSynthesisUtterance(item.text.trim());
                        
                        // Ë®≠ÂÆöË™ûÈü≥ÂèÉÊï∏
                        utterance.lang = 'en-US';
                        utterance.rate = 0.9;
                        utterance.pitch = 1.0;
                        utterance.volume = 1.0;
                        
                        // ÂòóË©¶Ë®≠ÂÆöÊåáÂÆöÁöÑË™ûÈü≥
                        const voices = speechSynthesis.getVoices();
                        let selectedVoice = null;
                        
                        console.log('ÂèØÁî®Ë™ûÈü≥Êï∏Èáè:', voices.length);
                        console.log('Ââç5ÂÄãË™ûÈü≥:', voices.slice(0, 5).map(v => v.name));
                        
                        if (item.voice === 'native') {
                            selectedVoice = voices.find(voice => voice.lang.includes('en-US')) || voices[0];
                        } else {
                            selectedVoice = voices.find(voice => 
                                voice.name.includes(item.voice) || 
                                voice.name === item.voice
                            );
                            if (!selectedVoice) {
                                selectedVoice = voices.find(voice => voice.lang.includes('en-US')) || voices[0];
                            }
                        }
                        
                        if (selectedVoice) {
                            utterance.voice = selectedVoice;
                        }
                        
                        this.speechQueue.push({
                            type: 'speech',
                            utterance: utterance,
                            text: item.text.trim()
                        });
                        
                        console.log('Ê∑ªÂä†Ë™ûÈü≥:', item.text.trim(), 'Ë™ûÈü≥:', selectedVoice?.name || 'È†êË®≠');
                        
                    } else if (item.type === 'pause') {
                        this.speechQueue.push({
                            type: 'pause',
                            duration: item.duration * 1000 // ËΩâÊèõÁÇ∫ÊØ´Áßí
                        });
                        console.log('Ê∑ªÂä†Êö´ÂÅú:', item.duration + 'Áßí');
                    }
                }
                
                if (this.speechQueue.length === 0) {
                    throw new Error('Ê≤íÊúâÊâæÂà∞Ë¶ÅÊúóËÆÄÁöÑÂÖßÂÆπ');
                }
                
                // Ë®≠ÂÆöÊí≠ÊîæÊéßÂà∂
                this.currentAudio = {
                    play: () => this.playBrowserSpeech(),
                    pause: () => speechSynthesis.cancel(),
                    currentTime: 0,
                    onended: null,
                    onerror: null
                };
                
                // È°ØÁ§∫ÁµêÊûú
                this.displayResults();
                this.showMessage('üéµ ÂÖçË≤ªË™ûÈü≥Â∑≤Ê∫ñÂÇôÂÆåÊàêÔºÅÈªûÊìäÊí≠ÊîæÊåâÈàïÈñãÂßãÊúóËÆÄ„ÄÇ', 'success');
            }
            
            // Á≠âÂæÖË™ûÈü≥ÂàóË°®ËºâÂÖ•ÁöÑËºîÂä©ÂáΩÊï∏
            waitForVoices() {
                return new Promise((resolve) => {
                    const voices = speechSynthesis.getVoices();
                    if (voices.length > 0) {
                        console.log('Ë™ûÈü≥ÂàóË°®Â∑≤ËºâÂÖ•ÔºåÂÖ±', voices.length, 'ÂÄãË™ûÈü≥');
                        resolve();
                        return;
                    }
                    
                    console.log('Á≠âÂæÖË™ûÈü≥ÂàóË°®ËºâÂÖ•...');
                    let attempts = 0;
                    const maxAttempts = 10;
                    
                    const checkVoices = () => {
                        const voices = speechSynthesis.getVoices();
                        attempts++;
                        
                        if (voices.length > 0) {
                            console.log('Ë™ûÈü≥ÂàóË°®ËºâÂÖ•ÂÆåÊàêÔºåÂÖ±', voices.length, 'ÂÄãË™ûÈü≥');
                            resolve();
                        } else if (attempts >= maxAttempts) {
                            console.log('Ë™ûÈü≥ÂàóË°®ËºâÂÖ•Ë∂ÖÊôÇÔºå‰ΩøÁî®È†êË®≠Ë®≠ÂÆö');
                            resolve();
                        } else {
                            setTimeout(checkVoices, 100);
                        }
                    };
                    
                    // Áõ£ËÅΩË™ûÈü≥ËÆäÊõ¥‰∫ã‰ª∂
                    speechSynthesis.addEventListener('voiceschanged', () => {
                        console.log('Ë™ûÈü≥ÂàóË°®Â∑≤Êõ¥Êñ∞');
                        resolve();
                    }, { once: true });
                    
                    // ÈñãÂßãÊ™¢Êü•
                    setTimeout(checkVoices, 100);
                });
            }
            
            async playBrowserSpeech() {
                return new Promise((resolve, reject) => {
                    let currentIndex = 0;
                    
                    const playNext = () => {
                        if (currentIndex >= this.speechQueue.length) {
                            if (this.currentAudio && this.currentAudio.onended) {
                                this.currentAudio.onended();
                            }
                            resolve();
                            return;
                        }
                        
                        const item = this.speechQueue[currentIndex];
                        currentIndex++;
                        
                        if (item.type === 'speech') {
                            item.utterance.onend = () => {
                                setTimeout(playNext, 100); // Áü≠Êö´ÈñìÈöî
                            };
                            
                            item.utterance.onerror = (error) => {
                                console.error('Ë™ûÈü≥Êí≠ÊîæÈåØË™§:', error);
                                if (this.currentAudio && this.currentAudio.onerror) {
                                    this.currentAudio.onerror();
                                }
                                reject(error);
                            };
                            
                            speechSynthesis.speak(item.utterance);
                            
                        } else if (item.type === 'pause') {
                            setTimeout(playNext, item.duration);
                        }
                    };
                    
                    playNext();
                });
            }
            
            async generateSpeechFallback() {
                // Â¶ÇÊûúÁÄèË¶ΩÂô®Ë™ûÈü≥‰πüÂ§±ÊïóÔºåÂâµÂª∫ÊñáÊú¨Ê™îÊ°à
                const scriptContent = this.scriptItems.map(item => {
                    if (item.type === 'text') {
                        return `ÊñáÂ≠ó: ${item.text} (Ë™ûÈü≥: ${item.voice})`;
                    } else {
                        return `Êö´ÂÅú: ${item.duration} Áßí`;
                    }
                }).join('\n');
                
                const textContent = `Ë™ûÈü≥ËÖ≥Êú¨ÂÖßÂÆπÔºö\n\n${scriptContent}\n\nÁîüÊàêÊôÇÈñìÔºö${new Date().toLocaleString()}\n\nÊ≥®ÊÑèÔºöÊ≠§ÁÇ∫ÂÇôÁî®ÊñπÊ°àÔºåÂ¶ÇÈúÄË™ûÈü≥Êí≠ÊîæÔºåË´ã‰ΩøÁî®ÊîØÊè¥Ë™ûÈü≥ÂêàÊàêÁöÑÁÄèË¶ΩÂô®`;
                this.currentBlob = new Blob([textContent], { type: 'text/plain;charset=utf-8' });
                
                this.displayResults();
                this.showMessage('ÁÄèË¶ΩÂô®‰∏çÊîØÊè¥Ë™ûÈü≥ÂêàÊàêÔºåÂ∑≤ÁîüÊàêÊñáÂ≠óÊ™îÊ°à„ÄÇ', 'success');
            }
            
            displayResults() {
                this.resultSection.style.display = 'block';
                this.showMessage('Ë™ûÈü≥Ê™îÊ°àÁîüÊàêÂÆåÊàêÔºÅÊÇ®ÂèØ‰ª•Êí≠ÊîæË©¶ËÅΩÊàñ‰∏ãËºâÊ™îÊ°à„ÄÇ', 'success');
                this.resultSection.scrollIntoView({ behavior: 'smooth' });
            }
            
            playAudio() {
                if (this.currentAudio) {
                    this.playBtn.textContent = 'üîä Êí≠Êîæ‰∏≠...';
                    this.playBtn.disabled = true;
                    
                    if (this.isPremiumMode) {
                        // È´òÂìÅË≥™Ê®°ÂºèÔºöÊí≠Êîæ MP3 Ê™îÊ°à
                        this.currentAudio.currentTime = 0;
                        this.currentAudio.play();
                        
                        this.currentAudio.onended = () => {
                            this.playBtn.textContent = '‚ñ∂Ô∏è Êí≠ÊîæÂÆåÊï¥Ë™ûÈü≥';
                            this.playBtn.disabled = false;
                        };
                        
                        this.currentAudio.onerror = () => {
                            this.playBtn.textContent = '‚ñ∂Ô∏è Êí≠ÊîæÂÆåÊï¥Ë™ûÈü≥';
                            this.playBtn.disabled = false;
                            this.showMessage('Êí≠ÊîæÂ§±ÊïóÔºåË´ãÈáçÊñ∞ÁîüÊàêË™ûÈü≥Ê™îÊ°à', 'error');
                        };
                    } else {
                        // ÂÖçË≤ªÊ®°ÂºèÔºö‰ΩøÁî®ÁÄèË¶ΩÂô®Ë™ûÈü≥ÂêàÊàê
                        this.currentAudio.onended = () => {
                            this.playBtn.textContent = '‚ñ∂Ô∏è Êí≠ÊîæÂÆåÊï¥Ë™ûÈü≥';
                            this.playBtn.disabled = false;
                        };
                        
                        this.currentAudio.onerror = () => {
                            this.playBtn.textContent = '‚ñ∂Ô∏è Êí≠ÊîæÂÆåÊï¥Ë™ûÈü≥';
                            this.playBtn.disabled = false;
                            this.showMessage('Êí≠ÊîæÂ§±ÊïóÔºåË´ãÈáçÊñ∞ÁîüÊàêË™ûÈü≥Ê™îÊ°à', 'error');
                        };
                        
                        this.currentAudio.play().catch(error => {
                            console.error('Êí≠ÊîæÈåØË™§:', error);
                            this.playBtn.textContent = '‚ñ∂Ô∏è Êí≠ÊîæÂÆåÊï¥Ë™ûÈü≥';
                            this.playBtn.disabled = false;
                            this.showMessage('Êí≠ÊîæÂ§±ÊïóÔºåË´ãÈáçÊñ∞ÁîüÊàêË™ûÈü≥Ê™îÊ°à', 'error');
                        });
                    }
                } else {
                    this.showMessage('Ë´ãÂÖàÁîüÊàêË™ûÈü≥Ê™îÊ°à', 'error');
                }
            }
            
            downloadAudio() {
                if (this.isPremiumMode && this.currentBlob) {
                    const timestamp = new Date().toISOString().slice(0, 19).replace(/:/g, '-');
                    const isMP3 = this.currentBlob.type === 'audio/mpeg';
                    const extension = isMP3 ? 'mp3' : 'txt';
                    const fileName = `Ë™ûÈü≥ËÖ≥Êú¨_${timestamp}.${extension}`;
                    
                    const url = URL.createObjectURL(this.currentBlob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = fileName;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    const message = isMP3 
                        ? 'üéµ MP3 Ê™îÊ°à‰∏ãËºâÈñãÂßãÔºÅÈÄôÊòØÊÇ®ÁöÑÂÆåÊï¥Ë™ûÈü≥ËÖ≥Êú¨Ê™îÊ°à„ÄÇ'
                        : 'üìÑ ÊñáÊú¨Ê™îÊ°à‰∏ãËºâÈñãÂßãÔºÅÂ¶ÇÈúÄ MP3 Ê™îÊ°àÔºåË´ãË®≠ÂÆö Google Cloud API Key„ÄÇ';
                    
                    this.showMessage(message, 'success');
                } else if (!this.isPremiumMode) {
                    this.showMessage('ÂÖçË≤ªÊ®°Âºè‰∏çÊîØÊè¥‰∏ãËºâÂäüËÉΩ„ÄÇÂ¶ÇÈúÄ‰∏ãËºâ MP3 Ê™îÊ°àÔºåË´ãÂàáÊèõÂà∞È´òÂìÅË≥™Ê®°Âºè‰∏¶Ë®≠ÂÆö API Key„ÄÇ', 'error');
                } else {
                    this.showMessage('Ë´ãÂÖàÁîüÊàêË™ûÈü≥Ê™îÊ°à', 'error');
                }
            }
            
            showMessage(message, type) {
                this.statusMessage.innerHTML = `<div class="${type}">${message}</div>`;
                
                // API Ë®≠ÂÆöÈåØË™§Ë®äÊÅØ‰∏çËá™ÂãïÊ∂àÂ§±ÔºåÂÖ∂‰ªñË®äÊÅØ 8 ÁßíÂæåÊ∂àÂ§±
                if (type === 'success' || (type === 'error' && !message.includes('API Â∞öÊú™ÂïüÁî®'))) {
                    setTimeout(() => {
                        this.statusMessage.innerHTML = '';
                    }, 8000);
                }
            }
        }
        
        // ÂÖ®ÂüüËÆäÊï∏‰æõ HTML ‰∫ã‰ª∂‰ΩøÁî®
        let generator;
        
        // È†ÅÈù¢ËºâÂÖ•ÂÆåÊàêÂæåÂàùÂßãÂåñ
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                generator = new ScriptBasedSpeechGenerator();
            });
        } else {
            generator = new ScriptBasedSpeechGenerator();
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'994f0bc9257f4a3c',t:'MTc2MTUzNTEwNS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
